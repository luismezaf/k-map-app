import{N as I,a as v,O as L,c as D,r as C,p as F,aT as w,aU as T,v as O,h as U,b as q,g as M,bt as Q,a3 as x,D as R,az as V,bu as _}from"./index.dbf76095.js";function B(r){function d(t){typeof t=="object"||Array.isArray(t)?localStorage.setItem(r,JSON.stringify(t)):t==null?localStorage.removeItem(r):localStorage.setItem(r,`${t}`)}function u(t){const a=localStorage.getItem(r);if(!a||a==="undefined"||a==="null")return t==null?void 0:t.defaultValue;try{return JSON.parse(a)}catch{return a}}function m(){localStorage.removeItem(r)}return{setLocalData:d,getLocalData:u,clearLocalData:m}}const k=1*60*1e3,N=30*1e3;function z(){const{setLocalData:r,getLocalData:d}=B("userProfile");async function u(){const l=new Date().toISOString(),g={coords:{latlng:[-25.276787891288645,-57.631576770951945],address:"Costanera de Asunci\xF3n",formatedAddress:"Costanera de Asunci\xF3n",lastUpdate:l},coordsHistory:[],createdAt:l,email:"awesome@person.com",id:"1",isActive:!0,isSuperuser:!0,name:"Awesome Person",permissions:[],requiredChangePassword:!1,trackCoords:!1,updatedAt:l,username:"awesomeperson"};return r(g),await new Promise(S=>setTimeout(S,200,g))}const{data:m,isLoading:t,error:a,isError:o,refetch:s}=I(["userProfile"],u,{refetchOnWindowFocus:!1,staleTime:N,initialData:d(),initialDataUpdatedAt:0});return{userProfile:v(()=>m.value),userProfileError:v(()=>a),isGettingProfile:t,isGettingProfileError:o,refetchProfile:s}}function J(){async function r(o){return new Promise(s=>setTimeout(s,2e3,{access:o.username,refresh:o.username}))}const{mutate:d,isLoading:u,isError:m,error:t}=L(o=>r(o),{onSuccess(o){const s=o.access,l=o.refresh;localStorage.setItem("access",s),localStorage.setItem("refresh",l)},onError(){a()}});function a(){localStorage.removeItem("access"),localStorage.removeItem("refresh"),api.defaults.headers.common.Authorization=void 0}return{login:d,logout:a,isLoging:v(()=>u.value),isLogingError:v(()=>m.value),logingError:v(()=>{var o,s;return(s=(o=t.value)==null?void 0:o.response)==null?void 0:s.data})}}var Y=D({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(r,{slots:d,emit:u}){const m=M(),t=C(null);let a=0;const o=[];function s(e){const f=typeof e=="boolean"?e:r.noErrorFocus!==!0,y=++a,E=(n,i)=>{u("validation"+(n===!0?"Success":"Error"),i)},P=n=>{const i=n.validate();return typeof i.then=="function"?i.then(c=>({valid:c,comp:n}),c=>({valid:!1,comp:n,err:c})):Promise.resolve({valid:i,comp:n})};return(r.greedy===!0?Promise.all(o.map(P)).then(n=>n.filter(i=>i.valid!==!0)):o.reduce((n,i)=>n.then(()=>P(i).then(c=>{if(c.valid===!1)return Promise.reject(c)})),Promise.resolve()).catch(n=>[n])).then(n=>{if(n===void 0||n.length===0)return y===a&&E(!0),!0;if(y===a){const{comp:i,err:c}=n[0];if(c!==void 0&&console.error(c),E(!1,i),f===!0){const p=n.find(({comp:A})=>typeof A.focus=="function"&&Q(A.$)===!1);p!==void 0&&p.comp.focus()}}return!1})}function l(){a++,o.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function g(e){e!==void 0&&x(e);const f=a+1;s().then(y=>{f===a&&y===!0&&(r.onSubmit!==void 0?u("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function S(e){e!==void 0&&x(e),u("reset"),R(()=>{l(),r.autofocus===!0&&r.noResetFocus!==!0&&h()})}function h(){V(()=>{if(t.value===null)return;const e=t.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||t.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||t.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(t.value.querySelectorAll("[tabindex]"),f=>f.tabIndex>-1);e!=null&&e.focus({preventScroll:!0})})}F(_,{bindComponent(e){o.push(e)},unbindComponent(e){const f=o.indexOf(e);f>-1&&o.splice(f,1)}});let b=!1;return w(()=>{b=!0}),T(()=>{b===!0&&r.autofocus===!0&&h()}),O(()=>{r.autofocus===!0&&h()}),Object.assign(m.proxy,{validate:s,resetValidation:l,submit:g,reset:S,focus:h,getValidationComponents:()=>o}),()=>U("form",{class:"q-form",ref:t,onSubmit:g,onReset:S},q(d.default))}});export{N as M,k as Q,Y as a,z as b,J as c,B as u};
